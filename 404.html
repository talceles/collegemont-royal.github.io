<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-itunes-app" content="app-id=1522031702">
    <link rel="icon" href="/site/favicon.png" type="image/png" sizes="16x16">
    <link rel="apple-touch-icon" href="/site/ressources/favicon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="stylesheet" type="text/css" href="/site/style/index.css">
    <meta name="theme-color" content="#1D2953">
    <title>Erreur 404</title>
</head>

<body id="body">
    <div class="header">
        <div class="headerTitleAndLogo">
            <a href=".">
                <button class="logo"></button>
            </a>
            <div class="headerTitle">
                <h1 class="title">Page non trouvée !</h1>
                <h5 class="headerSubtitle">Application CMR</h5>
            </div>
        </div>
        <button class="i"></button>
    </div>
    <div class="cells">
        <div class="cell"><img src="/files/images/404.png" />
            <div class="description">
                <h2 class="cell-title">Page non trouvée.</h2>
                <p class="cell-subtitle">Erreur 404 pour l'URL actuelle.</p>
            </div>
        </div>
        <div class="retour" onclick="window.location.assign('/');">
            <button class="retour"></button>
            <h2 class="retour">Retour à l'accueil</h2>
        </div>
        <div class="cell">
            <img src="/site/ressources/contact.png" />
            <div class="description">
                <h2 class="cell-title">On s'en occupe !</h2>
                <p class="cell-subtitle">Une notification a été envoyée à un administrateur pour régler le problème.</p>
            </div>
        </div>
    </div>

    <script type="module">
        // import { initialUISetup } from "/site/js/UIHandler.js";
        // initialUISetup();

        const urlParams = new URLSearchParams(window.location);
        const src = urlParams.get('src');
        if (src) {
            sendErrorMessage("Source non trouvée au " + src);
        } else {
            send404Message();
        }

        function send404Message() {
            fetch(
                "https://cmr-webhooks.herokuapp.com/404" +
                "?pathname=" + encodeURIComponent(window.location.pathname) +
                "&useragent=" + encodeURIComponent(window.navigator.userAgent),
                { method: "POST" }
            );
        }

        function sendErrorMessage(errorDescription) {
            fetch(
                "https://cmr-webhooks.herokuapp.com/err?pathname=" + encodeURIComponent(window.location.pathname) + "&src=" + encodeURIComponent(URLUtilities.getSrc()),
                {
                    method: "POST",
                    headers: { "Content-Type": "text/plain; charset=utf-8" },
                    body: errorDescription,
                }
            );
        }

    </script>

</body>

</html>